{"ast":null,"code":"import _toConsumableArray from \"/Users/hieutran/Desktop/create-social-network-master/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _taggedTemplateLiteral from \"/Users/hieutran/Desktop/create-social-network-master/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _jsxFileName = \"/Users/hieutran/Desktop/create-social-network-master/frontend/src/pages/Messages/MessagesUsers.js\",\n    _templateObject,\n    _templateObject2,\n    _templateObject3,\n    _templateObject4,\n    _templateObject5,\n    _templateObject6,\n    _templateObject7,\n    _templateObject8,\n    _templateObject9,\n    _templateObject10,\n    _templateObject11,\n    _templateObject12,\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\nimport { NavLink, generatePath, withRouter } from 'react-router-dom';\nimport { useQuery } from '@apollo/client';\nimport { GET_CONVERSATIONS } from 'graphql/user';\nimport { GET_NEW_CONVERSATIONS_SUBSCRIPTION } from 'graphql/messages';\nimport Search from 'components/Search';\nimport { PencilIcon } from 'components/icons';\nimport { LoadingDots } from 'components/Loading';\nimport Avatar from 'components/Avatar';\nimport * as Routes from 'routes';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar Root = styled.div(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n  width: 80px;\\n  height: 100%;\\n  border-right: 1px solid \", \";\\n\\n  @media (min-width: \", \") {\\n    width: 330px;\\n  }\\n\"])), function (p) {\n  return p.theme.colors.border.main;\n}, function (p) {\n  return p.theme.screen.lg;\n});\n_c = Root;\nvar HeadingContainer = styled.div(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\\n  border-bottom: 1px solid \", \";\\n  height: 60px;\\n  padding: 0 \", \";\\n  display: flex;\\n  flex-direction: row;\\n  align-items: center;\\n  justify-content: center;\\n\\n  @media (min-width: \", \") {\\n    justify-content: space-between;\\n  }\\n\"])), function (p) {\n  return p.theme.colors.border.main;\n}, function (p) {\n  return p.theme.spacing.xs;\n}, function (p) {\n  return p.theme.screen.lg;\n});\n_c2 = HeadingContainer;\nvar Heading = styled.h3(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\\n  display: none;\\n  color: \", \";\\n  margin: 0;\\n\\n  @media (min-width: \", \") {\\n    display: block;\\n  }\\n\"])), function (p) {\n  return p.theme.colors.text.primary;\n}, function (p) {\n  return p.theme.screen.lg;\n});\n_c3 = Heading;\nvar NewMessage = styled(NavLink)(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\\n  width: 40px;\\n  height: 40px;\\n  background-color: \", \";\\n  border-radius: 50%;\\n  display: flex;\\n  flex-direction: row;\\n  justify-content: center;\\n  align-items: center;\\n\"])), function (p) {\n  return p.theme.colors.grey[200];\n});\n_c4 = NewMessage;\nvar SearchContainer = styled.div(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"\\n  display: none;\\n  border-bottom: 1px solid \", \";\\n\\n  @media (min-width: \", \") {\\n    display: block;\\n  }\\n\"])), function (p) {\n  return p.theme.colors.border.main;\n}, function (p) {\n  return p.theme.screen.lg;\n});\n_c5 = SearchContainer;\nvar UserContainer = styled.div(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"\\n  margin-top: \", \";\\n  padding: 0 \", \";\\n\"])), function (p) {\n  return p.theme.spacing.sm;\n}, function (p) {\n  return p.theme.spacing.xxs;\n});\n_c6 = UserContainer;\nvar User = styled(NavLink)(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  padding: \", \" \", \";\\n  margin-bottom: \", \";\\n  border-radius: \", \";\\n  display: flex;\\n  flex-direction: row;\\n  justify-content: flex-start;\\n  align-items: center;\\n  text-decoration: none;\\n  color: \", \";\\n\\n  @media (max-width: \", \") {\\n    \", \";\\n  }\\n\\n  &.selected {\\n    background-color: \", \";\\n  }\\n\"])), function (p) {\n  return p.theme.spacing.xxs;\n}, function (p) {\n  return p.theme.spacing.xxs;\n}, function (p) {\n  return p.theme.spacing.xxs;\n}, function (p) {\n  return p.theme.radius.md;\n}, function (p) {\n  return p.theme.colors.text.primary;\n}, function (p) {\n  return p.theme.screen.lg;\n}, function (p) {\n  return !p.seen && \"\\n        background-color: \".concat(p.theme.colors.primary.light, \";\\n      \");\n}, function (p) {\n  return p.theme.colors.grey[100];\n});\n_c7 = User;\nvar Info = styled.div(_templateObject8 || (_templateObject8 = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  display: none;\\n  padding: 0 \", \";\\n\\n  @media (min-width: \", \") {\\n    display: block;\\n  }\\n\"])), function (p) {\n  return p.theme.spacing.xs;\n}, function (p) {\n  return p.theme.screen.lg;\n});\n_c8 = Info;\nvar FullNameUnSeen = styled.div(_templateObject9 || (_templateObject9 = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  font-size: \", \";\\n  display: flex;\\n  flex-direction: row;\\n  justify-content: space-between;\\n  align-items: center;\\n\"])), function (p) {\n  return p.theme.font.size.sm;\n});\n_c9 = FullNameUnSeen;\nvar FullName = styled.div(_templateObject10 || (_templateObject10 = _taggedTemplateLiteral([\"\\n  text-overflow: ellipsis;\\n  width: 100%;\\n\"])));\n_c10 = FullName;\nvar UnSeen = styled.div(_templateObject11 || (_templateObject11 = _taggedTemplateLiteral([\"\\n  width: 8px;\\n  height: 8px;\\n  background-color: \", \";\\n  border-radius: 50%;\\n\"])), function (p) {\n  return p.theme.colors.primary.light;\n});\n_c11 = UnSeen;\nvar LastMessage = styled.div(_templateObject12 || (_templateObject12 = _taggedTemplateLiteral([\"\\n  margin-top: \", \";\\n  font-size: \", \";\\n  color: \", \";\\n  text-overflow: ellipsis;\\n\"])), function (p) {\n  return p.theme.spacing.xxs;\n}, function (p) {\n  return p.theme.font.size.xxs;\n}, function (p) {\n  return p.theme.colors.grey[500];\n});\n/**\n * Component that renders users, with whom auth user had a chat\n */\n\n_c12 = LastMessage;\n\nvar MessagesUsers = function MessagesUsers(_ref) {\n  _s();\n\n  var location = _ref.location,\n      authUser = _ref.authUser;\n\n  var _useQuery = useQuery(GET_CONVERSATIONS, {\n    variables: {\n      authUserId: authUser.id\n    }\n  }),\n      subscribeToMore = _useQuery.subscribeToMore,\n      data = _useQuery.data,\n      loading = _useQuery.loading;\n\n  useEffect(function () {\n    var unsubscribe = subscribeToMore({\n      document: GET_NEW_CONVERSATIONS_SUBSCRIPTION,\n      updateQuery: function updateQuery(prev, _ref2) {\n        var subscriptionData = _ref2.subscriptionData;\n        if (!subscriptionData.data) return prev;\n        var newConversation = subscriptionData.data.newConversation;\n        var oldConversations = prev.getConversations;\n\n        if (oldConversations.some(function (u) {\n          return u.id === newConversation.id;\n        })) {\n          return prev;\n        } // Merge conversations\n\n\n        var conversations = newConversation;\n        delete conversations['receiverId'];\n        var mergedConversations = [newConversation].concat(_toConsumableArray(oldConversations));\n        return {\n          getConversations: mergedConversations\n        };\n      }\n    });\n    return function () {\n      unsubscribe();\n    };\n  }, [subscribeToMore]);\n  return /*#__PURE__*/_jsxDEV(Root, {\n    children: [/*#__PURE__*/_jsxDEV(HeadingContainer, {\n      children: [/*#__PURE__*/_jsxDEV(Heading, {\n        children: \"Chats\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(NewMessage, {\n        exact: true,\n        activeClassName: \"selected\",\n        to: generatePath(Routes.MESSAGES, {\n          userId: Routes.NEW_ID_VALUE\n        }),\n        children: /*#__PURE__*/_jsxDEV(PencilIcon, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(SearchContainer, {\n      children: /*#__PURE__*/_jsxDEV(Search, {\n        location: location,\n        backgroundColor: \"white\",\n        forMessage: true,\n        placeholder: \"Search message\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 7\n    }, _this), loading && /*#__PURE__*/_jsxDEV(LoadingDots, {\n      top: \"xl\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 19\n    }, _this), !loading && /*#__PURE__*/_jsxDEV(UserContainer, {\n      children: data.getConversations.map(function (user) {\n        var unseen = !user.lastMessageSender && !user.seen;\n        return /*#__PURE__*/_jsxDEV(User, {\n          activeClassName: \"selected\",\n          to: \"/messages/\".concat(user.id),\n          seen: unseen ? 0 : 1,\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: /*#__PURE__*/_jsxDEV(Avatar, {\n              image: user.image,\n              size: 50\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 202,\n              columnNumber: 19\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 201,\n            columnNumber: 17\n          }, _this), /*#__PURE__*/_jsxDEV(Info, {\n            children: [/*#__PURE__*/_jsxDEV(FullNameUnSeen, {\n              children: [/*#__PURE__*/_jsxDEV(FullName, {\n                children: user.fullName\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 207,\n                columnNumber: 21\n              }, _this), unseen && /*#__PURE__*/_jsxDEV(UnSeen, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 209,\n                columnNumber: 32\n              }, _this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 206,\n              columnNumber: 19\n            }, _this), /*#__PURE__*/_jsxDEV(LastMessage, {\n              children: [user.lastMessageSender && 'You:', \" \", user.lastMessage]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 212,\n              columnNumber: 19\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 17\n          }, _this)]\n        }, user.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 15\n        }, _this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 9\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 175,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(MessagesUsers, \"deF0uAjVO+DV1hY+7R5U9XLnA8g=\", false, function () {\n  return [useQuery];\n});\n\n_c13 = MessagesUsers;\nMessagesUsers.propTypes = {\n  location: PropTypes.object.isRequired,\n  authUser: PropTypes.object.isRequired\n};\nexport default _c14 = withRouter(MessagesUsers);\n\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9, _c10, _c11, _c12, _c13, _c14;\n\n$RefreshReg$(_c, \"Root\");\n$RefreshReg$(_c2, \"HeadingContainer\");\n$RefreshReg$(_c3, \"Heading\");\n$RefreshReg$(_c4, \"NewMessage\");\n$RefreshReg$(_c5, \"SearchContainer\");\n$RefreshReg$(_c6, \"UserContainer\");\n$RefreshReg$(_c7, \"User\");\n$RefreshReg$(_c8, \"Info\");\n$RefreshReg$(_c9, \"FullNameUnSeen\");\n$RefreshReg$(_c10, \"FullName\");\n$RefreshReg$(_c11, \"UnSeen\");\n$RefreshReg$(_c12, \"LastMessage\");\n$RefreshReg$(_c13, \"MessagesUsers\");\n$RefreshReg$(_c14, \"%default%\");","map":{"version":3,"sources":["/Users/hieutran/Desktop/create-social-network-master/frontend/src/pages/Messages/MessagesUsers.js"],"names":["React","useEffect","PropTypes","styled","NavLink","generatePath","withRouter","useQuery","GET_CONVERSATIONS","GET_NEW_CONVERSATIONS_SUBSCRIPTION","Search","PencilIcon","LoadingDots","Avatar","Routes","Root","div","p","theme","colors","border","main","screen","lg","HeadingContainer","spacing","xs","Heading","h3","text","primary","NewMessage","grey","SearchContainer","UserContainer","sm","xxs","User","radius","md","seen","light","Info","FullNameUnSeen","font","size","FullName","UnSeen","LastMessage","MessagesUsers","location","authUser","variables","authUserId","id","subscribeToMore","data","loading","unsubscribe","document","updateQuery","prev","subscriptionData","newConversation","oldConversations","getConversations","some","u","conversations","mergedConversations","MESSAGES","userId","NEW_ID_VALUE","map","user","unseen","lastMessageSender","image","fullName","lastMessage","propTypes","object","isRequired"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\nimport { NavLink, generatePath, withRouter } from 'react-router-dom';\nimport { useQuery } from '@apollo/client';\n\nimport { GET_CONVERSATIONS } from 'graphql/user';\nimport { GET_NEW_CONVERSATIONS_SUBSCRIPTION } from 'graphql/messages';\n\nimport Search from 'components/Search';\nimport { PencilIcon } from 'components/icons';\nimport { LoadingDots } from 'components/Loading';\nimport Avatar from 'components/Avatar';\n\nimport * as Routes from 'routes';\n\nconst Root = styled.div`\n  width: 80px;\n  height: 100%;\n  border-right: 1px solid ${(p) => p.theme.colors.border.main};\n\n  @media (min-width: ${(p) => p.theme.screen.lg}) {\n    width: 330px;\n  }\n`;\n\nconst HeadingContainer = styled.div`\n  border-bottom: 1px solid ${(p) => p.theme.colors.border.main};\n  height: 60px;\n  padding: 0 ${(p) => p.theme.spacing.xs};\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: center;\n\n  @media (min-width: ${(p) => p.theme.screen.lg}) {\n    justify-content: space-between;\n  }\n`;\n\nconst Heading = styled.h3`\n  display: none;\n  color: ${(p) => p.theme.colors.text.primary};\n  margin: 0;\n\n  @media (min-width: ${(p) => p.theme.screen.lg}) {\n    display: block;\n  }\n`;\n\nconst NewMessage = styled(NavLink)`\n  width: 40px;\n  height: 40px;\n  background-color: ${(p) => p.theme.colors.grey[200]};\n  border-radius: 50%;\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n`;\n\nconst SearchContainer = styled.div`\n  display: none;\n  border-bottom: 1px solid ${(p) => p.theme.colors.border.main};\n\n  @media (min-width: ${(p) => p.theme.screen.lg}) {\n    display: block;\n  }\n`;\n\nconst UserContainer = styled.div`\n  margin-top: ${(p) => p.theme.spacing.sm};\n  padding: 0 ${(p) => p.theme.spacing.xxs};\n`;\n\nconst User = styled(NavLink)`\n  width: 100%;\n  padding: ${(p) => p.theme.spacing.xxs} ${(p) => p.theme.spacing.xxs};\n  margin-bottom: ${(p) => p.theme.spacing.xxs};\n  border-radius: ${(p) => p.theme.radius.md};\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-start;\n  align-items: center;\n  text-decoration: none;\n  color: ${(p) => p.theme.colors.text.primary};\n\n  @media (max-width: ${(p) => p.theme.screen.lg}) {\n    ${(p) =>\n      !p.seen &&\n      `\n        background-color: ${p.theme.colors.primary.light};\n      `};\n  }\n\n  &.selected {\n    background-color: ${(p) => p.theme.colors.grey[100]};\n  }\n`;\n\nconst Info = styled.div`\n  width: 100%;\n  display: none;\n  padding: 0 ${(p) => p.theme.spacing.xs};\n\n  @media (min-width: ${(p) => p.theme.screen.lg}) {\n    display: block;\n  }\n`;\n\nconst FullNameUnSeen = styled.div`\n  width: 100%;\n  font-size: ${(p) => p.theme.font.size.sm};\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n`;\n\nconst FullName = styled.div`\n  text-overflow: ellipsis;\n  width: 100%;\n`;\n\nconst UnSeen = styled.div`\n  width: 8px;\n  height: 8px;\n  background-color: ${(p) => p.theme.colors.primary.light};\n  border-radius: 50%;\n`;\n\nconst LastMessage = styled.div`\n  margin-top: ${(p) => p.theme.spacing.xxs};\n  font-size: ${(p) => p.theme.font.size.xxs};\n  color: ${(p) => p.theme.colors.grey[500]};\n  text-overflow: ellipsis;\n`;\n\n/**\n * Component that renders users, with whom auth user had a chat\n */\nconst MessagesUsers = ({ location, authUser }) => {\n  const { subscribeToMore, data, loading } = useQuery(GET_CONVERSATIONS, {\n    variables: { authUserId: authUser.id },\n  });\n\n  useEffect(() => {\n    const unsubscribe = subscribeToMore({\n      document: GET_NEW_CONVERSATIONS_SUBSCRIPTION,\n      updateQuery: (prev, { subscriptionData }) => {\n        if (!subscriptionData.data) return prev;\n\n        const { newConversation } = subscriptionData.data;\n        const oldConversations = prev.getConversations;\n\n        if (oldConversations.some((u) => u.id === newConversation.id)) {\n          return prev;\n        }\n\n        // Merge conversations\n        const conversations = newConversation;\n        delete conversations['receiverId'];\n        const mergedConversations = [newConversation, ...oldConversations];\n\n        return { getConversations: mergedConversations };\n      },\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [subscribeToMore]);\n\n  return (\n    <Root>\n      <HeadingContainer>\n        <Heading>Chats</Heading>\n\n        <NewMessage\n          exact\n          activeClassName=\"selected\"\n          to={generatePath(Routes.MESSAGES, { userId: Routes.NEW_ID_VALUE })}\n        >\n          <PencilIcon />\n        </NewMessage>\n      </HeadingContainer>\n\n      <SearchContainer>\n        <Search location={location} backgroundColor=\"white\" forMessage placeholder=\"Search message\" />\n      </SearchContainer>\n\n      {loading && <LoadingDots top=\"xl\" />}\n\n      {!loading && (\n        <UserContainer>\n          {data.getConversations.map((user) => {\n            const unseen = !user.lastMessageSender && !user.seen;\n\n            return (\n              <User key={user.id} activeClassName=\"selected\" to={`/messages/${user.id}`} seen={unseen ? 0 : 1}>\n                <span>\n                  <Avatar image={user.image} size={50} />\n                </span>\n\n                <Info>\n                  <FullNameUnSeen>\n                    <FullName>{user.fullName}</FullName>\n\n                    {unseen && <UnSeen />}\n                  </FullNameUnSeen>\n\n                  <LastMessage>\n                    {user.lastMessageSender && 'You:'} {user.lastMessage}\n                  </LastMessage>\n                </Info>\n              </User>\n            );\n          })}\n        </UserContainer>\n      )}\n    </Root>\n  );\n};\n\nMessagesUsers.propTypes = {\n  location: PropTypes.object.isRequired,\n  authUser: PropTypes.object.isRequired,\n};\n\nexport default withRouter(MessagesUsers);\n"]},"metadata":{},"sourceType":"module"}