{"ast":null,"code":"import _regeneratorRuntime from \"/Users/hieutran/Desktop/create-social-network-master/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/hieutran/Desktop/create-social-network-master/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/hieutran/Desktop/create-social-network-master/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"/Users/hieutran/Desktop/create-social-network-master/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _jsxFileName = \"/Users/hieutran/Desktop/create-social-network-master/frontend/src/components/CreatePost.js\",\n    _templateObject,\n    _templateObject2,\n    _templateObject3,\n    _templateObject4,\n    _templateObject5,\n    _templateObject6,\n    _templateObject7,\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport { useMutation } from '@apollo/client';\nimport styled from 'styled-components';\nimport { Spacing, Overlay, Container } from 'components/Layout';\nimport { Error } from 'components/Text';\nimport { Button } from 'components/Form';\nimport Avatar from 'components/Avatar';\nimport PostImageUpload from 'pages/Home/PostImageUpload';\nimport { GET_FOLLOWED_POSTS, CREATE_POST } from 'graphql/post';\nimport { GET_AUTH_USER, GET_USER_POSTS } from 'graphql/user';\nimport { useStore } from 'store';\nimport { PROFILE_PAGE_POSTS_LIMIT } from 'constants/DataLimit';\nimport { HOME_PAGE_POSTS_LIMIT } from 'constants/DataLimit';\nimport { MAX_POST_IMAGE_SIZE } from 'constants/ImageSize';\nimport { useGlobalMessage } from 'hooks/useGlobalMessage';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nvar Root = styled(Container)(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n  border: 0;\\n  border: 1px solid \", \";\\n\"])), function (p) {\n  return p.theme.colors.border.main;\n});\n_c = Root;\nvar Wrapper = styled.div(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: row;\\n  justify-content: space-between;\\n  padding: \", \" 0;\\n\"])), function (p) {\n  return p.theme.spacing.sm;\n});\n_c2 = Wrapper;\nvar Textarea = styled.textarea(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  margin: 0 \", \";\\n  padding-left: \", \";\\n  padding-top: \", \";\\n  border: 0;\\n  outline: none;\\n  resize: none;\\n  transition: 0.1s ease-out;\\n  height: \", \";\\n  font-size: \", \";\\n  background-color: \", \";\\n  border-radius: \", \";\\n\"])), function (p) {\n  return p.theme.spacing.xs;\n}, function (p) {\n  return p.theme.spacing.sm;\n}, function (p) {\n  return p.theme.spacing.xs;\n}, function (p) {\n  return p.focus ? '80px' : '40px';\n}, function (p) {\n  return p.theme.font.size.xs;\n}, function (p) {\n  return p.theme.colors.grey[100];\n}, function (p) {\n  return p.theme.radius.md;\n});\n_c3 = Textarea;\nvar ImagePreviewContainer = styled.div(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\\n  width: 150px;\\n  height: 150px;\\n  overflow: hidden;\\n  flex-shrink: 0;\\n  box-shadow: \", \";\\n\"])), function (p) {\n  return p.theme.shadows.sm;\n});\n_c4 = ImagePreviewContainer;\nvar ImagePreview = styled.img(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 100%;\\n  object-fit: cover;\\n\"])));\n_c5 = ImagePreview;\nvar Options = styled.div(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: row;\\n  justify-content: space-between;\\n  border-top: 1px solid \", \";\\n  padding: \", \" 0;\\n\"])), function (p) {\n  return p.theme.colors.border.main;\n}, function (p) {\n  return p.theme.spacing.sm;\n});\n_c6 = Options;\nvar Buttons = styled.div(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: row;\\n\"])));\n/**\n * Component for creating a post\n */\n\n_c7 = Buttons;\n\nvar CreatePost = function CreatePost() {\n  _s();\n\n  var _useStore = useStore(),\n      _useStore2 = _slicedToArray(_useStore, 1),\n      auth = _useStore2[0].auth;\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      title = _useState2[0],\n      setTitle = _useState2[1];\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      image = _useState4[0],\n      setImage = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isFocused = _useState6[0],\n      setIsFocused = _useState6[1];\n\n  var _useState7 = useState(''),\n      _useState8 = _slicedToArray(_useState7, 2),\n      error = _useState8[0],\n      setError = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      apiError = _useState10[0],\n      setApiError = _useState10[1];\n\n  var message = useGlobalMessage();\n\n  var _useMutation = useMutation(CREATE_POST, {\n    refetchQueries: [{\n      query: GET_FOLLOWED_POSTS,\n      variables: {\n        userId: auth.user.id,\n        skip: 0,\n        limit: HOME_PAGE_POSTS_LIMIT\n      }\n    }, {\n      query: GET_AUTH_USER\n    }, {\n      query: GET_USER_POSTS,\n      variables: {\n        username: auth.user.username,\n        skip: 0,\n        limit: PROFILE_PAGE_POSTS_LIMIT\n      }\n    }]\n  }),\n      _useMutation2 = _slicedToArray(_useMutation, 2),\n      createPost = _useMutation2[0],\n      loading = _useMutation2[1].loading;\n\n  var handleReset = function handleReset() {\n    setTitle('');\n    setImage('');\n    setIsFocused(false);\n    setError('');\n    setApiError(false);\n  };\n\n  var handleOnFocus = function handleOnFocus() {\n    return setIsFocused(true);\n  };\n\n  var handlePostImageUpload = function handlePostImageUpload(e) {\n    var file = e.target.files[0];\n    if (!file) return;\n\n    if (file.size >= MAX_POST_IMAGE_SIZE) {\n      message.error(\"File size should be less then \".concat(MAX_POST_IMAGE_SIZE / 1000000, \"MB\"));\n      return;\n    }\n\n    setImage(file);\n    setIsFocused(true);\n    e.target.value = null;\n  };\n\n  var handleTitleChange = function handleTitleChange(e) {\n    return setTitle(e.target.value);\n  };\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              _context.prev = 1;\n              _context.next = 4;\n              return createPost({\n                variables: {\n                  input: {\n                    title: title,\n                    image: image,\n                    authorId: auth.user.id\n                  }\n                }\n              });\n\n            case 4:\n              handleReset();\n              _context.next = 10;\n              break;\n\n            case 7:\n              _context.prev = 7;\n              _context.t0 = _context[\"catch\"](1);\n              setApiError(true);\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 7]]);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var isShareDisabled = loading || !loading && !image && !title;\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [isFocused && /*#__PURE__*/_jsxDEV(Overlay, {\n      onClick: handleReset\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 21\n    }, _this), /*#__PURE__*/_jsxDEV(Root, {\n      zIndex: isFocused ? 'md' : 'xs',\n      color: \"white\",\n      radius: \"sm\",\n      padding: \"sm\",\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit,\n        children: [/*#__PURE__*/_jsxDEV(Wrapper, {\n          children: [/*#__PURE__*/_jsxDEV(Avatar, {\n            image: auth.user.image,\n            size: 40\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 159,\n            columnNumber: 13\n          }, _this), /*#__PURE__*/_jsxDEV(Textarea, {\n            type: \"textarea\",\n            name: \"title\",\n            focus: isFocused,\n            value: title,\n            onFocus: handleOnFocus,\n            onChange: handleTitleChange,\n            placeholder: \"Add a post\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 13\n          }, _this), !isFocused && /*#__PURE__*/_jsxDEV(PostImageUpload, {\n            handleChange: handlePostImageUpload\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 171,\n            columnNumber: 28\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 11\n        }, _this), image && /*#__PURE__*/_jsxDEV(Spacing, {\n          bottom: \"sm\",\n          children: /*#__PURE__*/_jsxDEV(ImagePreviewContainer, {\n            children: /*#__PURE__*/_jsxDEV(ImagePreview, {\n              src: URL.createObjectURL(image)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 177,\n              columnNumber: 17\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 176,\n            columnNumber: 15\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 13\n        }, _this), isFocused && /*#__PURE__*/_jsxDEV(Options, {\n          children: [/*#__PURE__*/_jsxDEV(PostImageUpload, {\n            label: \"Photo\",\n            handleChange: handlePostImageUpload\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(Buttons, {\n            children: [/*#__PURE__*/_jsxDEV(Button, {\n              text: true,\n              type: \"button\",\n              onClick: handleReset,\n              children: \"Cancel\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 187,\n              columnNumber: 17\n            }, _this), /*#__PURE__*/_jsxDEV(Button, {\n              disabled: isShareDisabled,\n              type: \"submit\",\n              children: \"Share\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 17\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 186,\n            columnNumber: 15\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 13\n        }, _this), apiError || error && /*#__PURE__*/_jsxDEV(Spacing, {\n          top: \"xs\",\n          bottom: \"sm\",\n          children: /*#__PURE__*/_jsxDEV(Error, {\n            size: \"xs\",\n            children: apiError ? 'Something went wrong, please try again.' : error\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 17\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 15\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true);\n};\n\n_s(CreatePost, \"7qhMd+XObqpuZD0LuOViSaMvD00=\", false, function () {\n  return [useStore, useGlobalMessage, useMutation];\n});\n\n_c8 = CreatePost;\nexport default CreatePost;\n\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8;\n\n$RefreshReg$(_c, \"Root\");\n$RefreshReg$(_c2, \"Wrapper\");\n$RefreshReg$(_c3, \"Textarea\");\n$RefreshReg$(_c4, \"ImagePreviewContainer\");\n$RefreshReg$(_c5, \"ImagePreview\");\n$RefreshReg$(_c6, \"Options\");\n$RefreshReg$(_c7, \"Buttons\");\n$RefreshReg$(_c8, \"CreatePost\");","map":{"version":3,"sources":["/Users/hieutran/Desktop/create-social-network-master/frontend/src/components/CreatePost.js"],"names":["React","useState","useMutation","styled","Spacing","Overlay","Container","Error","Button","Avatar","PostImageUpload","GET_FOLLOWED_POSTS","CREATE_POST","GET_AUTH_USER","GET_USER_POSTS","useStore","PROFILE_PAGE_POSTS_LIMIT","HOME_PAGE_POSTS_LIMIT","MAX_POST_IMAGE_SIZE","useGlobalMessage","Root","p","theme","colors","border","main","Wrapper","div","spacing","sm","Textarea","textarea","xs","focus","font","size","grey","radius","md","ImagePreviewContainer","shadows","ImagePreview","img","Options","Buttons","CreatePost","auth","title","setTitle","image","setImage","isFocused","setIsFocused","error","setError","apiError","setApiError","message","refetchQueries","query","variables","userId","user","id","skip","limit","username","createPost","loading","handleReset","handleOnFocus","handlePostImageUpload","e","file","target","files","value","handleTitleChange","handleSubmit","preventDefault","input","authorId","isShareDisabled","URL","createObjectURL"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport { useMutation } from '@apollo/client';\nimport styled from 'styled-components';\n\nimport { Spacing, Overlay, Container } from 'components/Layout';\nimport { Error } from 'components/Text';\nimport { Button } from 'components/Form';\nimport Avatar from 'components/Avatar';\n\nimport PostImageUpload from 'pages/Home/PostImageUpload';\n\nimport { GET_FOLLOWED_POSTS, CREATE_POST } from 'graphql/post';\nimport { GET_AUTH_USER, GET_USER_POSTS } from 'graphql/user';\n\nimport { useStore } from 'store';\n\nimport { PROFILE_PAGE_POSTS_LIMIT } from 'constants/DataLimit';\nimport { HOME_PAGE_POSTS_LIMIT } from 'constants/DataLimit';\nimport { MAX_POST_IMAGE_SIZE } from 'constants/ImageSize';\n\nimport { useGlobalMessage } from 'hooks/useGlobalMessage';\n\nconst Root = styled(Container)`\n  border: 0;\n  border: 1px solid ${(p) => p.theme.colors.border.main};\n`;\n\nconst Wrapper = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  padding: ${(p) => p.theme.spacing.sm} 0;\n`;\n\nconst Textarea = styled.textarea`\n  width: 100%;\n  margin: 0 ${(p) => p.theme.spacing.xs};\n  padding-left: ${(p) => p.theme.spacing.sm};\n  padding-top: ${(p) => p.theme.spacing.xs};\n  border: 0;\n  outline: none;\n  resize: none;\n  transition: 0.1s ease-out;\n  height: ${(p) => (p.focus ? '80px' : '40px')};\n  font-size: ${(p) => p.theme.font.size.xs};\n  background-color: ${(p) => p.theme.colors.grey[100]};\n  border-radius: ${(p) => p.theme.radius.md};\n`;\n\nconst ImagePreviewContainer = styled.div`\n  width: 150px;\n  height: 150px;\n  overflow: hidden;\n  flex-shrink: 0;\n  box-shadow: ${(p) => p.theme.shadows.sm};\n`;\n\nconst ImagePreview = styled.img`\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n`;\n\nconst Options = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  border-top: 1px solid ${(p) => p.theme.colors.border.main};\n  padding: ${(p) => p.theme.spacing.sm} 0;\n`;\n\nconst Buttons = styled.div`\n  display: flex;\n  flex-direction: row;\n`;\n\n/**\n * Component for creating a post\n */\nconst CreatePost = () => {\n  const [{ auth }] = useStore();\n  const [title, setTitle] = useState('');\n  const [image, setImage] = useState('');\n  const [isFocused, setIsFocused] = useState(false);\n  const [error, setError] = useState('');\n  const [apiError, setApiError] = useState(false);\n  const message = useGlobalMessage();\n  const [createPost, { loading }] = useMutation(CREATE_POST, {\n    refetchQueries: [\n      {\n        query: GET_FOLLOWED_POSTS,\n        variables: {\n          userId: auth.user.id,\n          skip: 0,\n          limit: HOME_PAGE_POSTS_LIMIT,\n        },\n      },\n      { query: GET_AUTH_USER },\n      {\n        query: GET_USER_POSTS,\n        variables: {\n          username: auth.user.username,\n          skip: 0,\n          limit: PROFILE_PAGE_POSTS_LIMIT,\n        },\n      },\n    ],\n  });\n\n  const handleReset = () => {\n    setTitle('');\n    setImage('');\n    setIsFocused(false);\n    setError('');\n    setApiError(false);\n  };\n\n  const handleOnFocus = () => setIsFocused(true);\n\n  const handlePostImageUpload = (e) => {\n    const file = e.target.files[0];\n\n    if (!file) return;\n\n    if (file.size >= MAX_POST_IMAGE_SIZE) {\n      message.error(`File size should be less then ${MAX_POST_IMAGE_SIZE / 1000000}MB`);\n      return;\n    }\n\n    setImage(file);\n\n    setIsFocused(true);\n    e.target.value = null;\n  };\n\n  const handleTitleChange = (e) => setTitle(e.target.value);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    try {\n      await createPost({\n        variables: { input: { title, image, authorId: auth.user.id } },\n      });\n      handleReset();\n    } catch (error) {\n      setApiError(true);\n    }\n  };\n\n  const isShareDisabled = loading || (!loading && !image && !title);\n\n  return (\n    <>\n      {isFocused && <Overlay onClick={handleReset} />}\n\n      <Root zIndex={isFocused ? 'md' : 'xs'} color=\"white\" radius=\"sm\" padding=\"sm\">\n        <form onSubmit={handleSubmit}>\n          <Wrapper>\n            <Avatar image={auth.user.image} size={40} />\n\n            <Textarea\n              type=\"textarea\"\n              name=\"title\"\n              focus={isFocused}\n              value={title}\n              onFocus={handleOnFocus}\n              onChange={handleTitleChange}\n              placeholder=\"Add a post\"\n            />\n\n            {!isFocused && <PostImageUpload handleChange={handlePostImageUpload} />}\n          </Wrapper>\n\n          {image && (\n            <Spacing bottom=\"sm\">\n              <ImagePreviewContainer>\n                <ImagePreview src={URL.createObjectURL(image)} />\n              </ImagePreviewContainer>\n            </Spacing>\n          )}\n\n          {isFocused && (\n            <Options>\n              <PostImageUpload label=\"Photo\" handleChange={handlePostImageUpload} />\n\n              <Buttons>\n                <Button text type=\"button\" onClick={handleReset}>\n                  Cancel\n                </Button>\n                <Button disabled={isShareDisabled} type=\"submit\">\n                  Share\n                </Button>\n              </Buttons>\n            </Options>\n          )}\n\n          {apiError ||\n            (error && (\n              <Spacing top=\"xs\" bottom=\"sm\">\n                <Error size=\"xs\">{apiError ? 'Something went wrong, please try again.' : error}</Error>\n              </Spacing>\n            ))}\n        </form>\n      </Root>\n    </>\n  );\n};\n\nexport default CreatePost;\n"]},"metadata":{},"sourceType":"module"}