{"ast":null,"code":"import _slicedToArray from \"/Users/hieutran/Desktop/create-social-network-master/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"/Users/hieutran/Desktop/create-social-network-master/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _jsxFileName = \"/Users/hieutran/Desktop/create-social-network-master/frontend/src/pages/Messages/MessagesChatConversation.js\",\n    _templateObject,\n    _templateObject2,\n    _templateObject3,\n    _templateObject4,\n    _templateObject5,\n    _templateObject6,\n    _templateObject7,\n    _templateObject8,\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport styled from 'styled-components';\nimport PropTypes from 'prop-types';\nimport { useMutation } from '@apollo/client';\nimport { Button, Textarea } from 'components/Form';\nimport { SendIcon } from 'components/icons';\nimport Avatar from 'components/Avatar';\nimport { Spacing } from 'components/Layout';\nimport { CREATE_MESSAGE } from 'graphql/messages';\nimport { GET_CONVERSATIONS } from 'graphql/user';\nimport { currentDate } from 'utils/date';\nimport * as Routes from 'routes';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar Root = styled.div(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n  padding: 0 \", \";\\n  overflow-y: auto;\\n  height: 100vh;\\n  margin-top: -120px;\\n  padding-top: 120px;\\n  display: flex;\\n  flex-direction: column;\\n\\n  ::-webkit-scrollbar {\\n    width: 8px;\\n  }\\n\\n  ::-webkit-scrollbar-thumb {\\n    background-color: \", \";\\n    border-radius: \", \";\\n    visibility: hidden;\\n\\n    &:hover {\\n      background-color: \", \";\\n    }\\n  }\\n\\n  &:hover {\\n    ::-webkit-scrollbar-thumb {\\n      visibility: visible;\\n    }\\n  }\\n\"])), function (p) {\n  return p.theme.spacing.sm;\n}, function (p) {\n  return p.theme.colors.grey[500];\n}, function (p) {\n  return p.theme.radius.lg;\n}, function (p) {\n  return p.theme.colors.grey[600];\n});\n_c = Root;\nvar Conversation = styled.div(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\\n  flex: 1;\\n\"])));\n_c2 = Conversation;\nvar MessageDate = styled.span(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\\n  position: absolute;\\n  bottom: -\", \";\\n  left: \", \";\\n  right: -\", \";\\n  display: none;\\n  font-size: \", \";\\n  color: \", \";\\n\"])), function (p) {\n  return p.theme.spacing.sm;\n}, function (p) {\n  return !p.userMessage && p.theme.spacing.lg;\n}, function (p) {\n  return p.userMessage && 0;\n}, function (p) {\n  return p.theme.font.size.tiny;\n}, function (p) {\n  return p.theme.colors.text.secondary;\n});\n_c3 = MessageDate;\nvar MessageWrapper = styled.div(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\\n  display: flex;\\n  position: relative;\\n  justify-content: \", \";\\n  margin: \", \" 0;\\n\\n  &:hover \", \" {\\n    display: block;\\n  }\\n\"])), function (p) {\n  return p.userMessage && 'flex-end';\n}, function (p) {\n  return p.theme.spacing.md;\n}, MessageDate);\n_c4 = MessageWrapper;\nvar Message = styled.div(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: row;\\n  position: relative;\\n  max-width: 300px;\\n  line-height: 21px;\\n  font-size: \", \";\\n  padding: \", \" \", \";\\n  border-radius: \", \";\\n  color: \", \";\\n  background-color: \", \";\\n\"])), function (p) {\n  return p.theme.font.size.xs;\n}, function (p) {\n  return p.theme.spacing.xxs;\n}, function (p) {\n  return p.theme.spacing.xs;\n}, function (p) {\n  return p.theme.radius.lg;\n}, function (p) {\n  return p.userMessage && p.theme.colors.white;\n}, function (p) {\n  return p.userMessage ? p.theme.colors.primary.light : p.theme.colors.grey[200];\n});\n_c5 = Message;\nvar Form = styled.form(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"\\n  background-color: \", \";\\n  position: sticky;\\n  bottom: 0;\\n  width: 100%;\\n  display: flex;\\n  padding: \", \";\\n\"])), function (p) {\n  return p.theme.colors.white;\n}, function (p) {\n  return p.theme.spacing.xxs;\n});\n_c6 = Form;\nvar StyledTextarea = styled(Textarea)(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"\\n  height: 38px;\\n  border-radius: \", \";\\n  background-color: \", \";\\n\"])), function (p) {\n  return p.theme.radius.lg;\n}, function (p) {\n  return p.theme.colors.grey[200];\n});\n_c7 = StyledTextarea;\nvar SendButton = styled(Button)(_templateObject8 || (_templateObject8 = _taggedTemplateLiteral([\"\\n  margin-left: \", \";\\n  align-self: center;\\n\"])), function (p) {\n  return p.theme.spacing.sm;\n});\n/**\n * Component that renders messages conversations UI\n */\n\n_c8 = SendButton;\n\nvar MessagesChatConversation = function MessagesChatConversation(_ref) {\n  _s();\n\n  var messages = _ref.messages,\n      authUser = _ref.authUser,\n      chatUser = _ref.chatUser,\n      data = _ref.data,\n      match = _ref.match;\n  var bottomRef = useRef(null);\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      messageText = _useState2[0],\n      setMessageText = _useState2[1];\n\n  var _useMutation = useMutation(CREATE_MESSAGE),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      createMessage = _useMutation2[0];\n\n  useEffect(function () {\n    if (bottomRef.current) {\n      bottomRef.current.scrollIntoView();\n    }\n  }, [bottomRef, data]);\n\n  var sendMessage = function sendMessage(e) {\n    e.preventDefault();\n    if (!messageText) return;\n    setMessageText('');\n    createMessage({\n      variables: {\n        input: {\n          sender: authUser.id,\n          receiver: chatUser ? chatUser.id : null,\n          message: messageText\n        }\n      },\n      refetchQueries: function refetchQueries(_ref2) {\n        var data = _ref2.data;\n\n        if (data && data.createMessage && data.createMessage.isFirstMessage) {\n          return [{\n            query: GET_CONVERSATIONS,\n            variables: {\n              authUserId: authUser.id\n            }\n          }];\n        }\n      }\n    });\n  };\n\n  var onEnterPress = function onEnterPress(e) {\n    if (e.keyCode === 13 && e.shiftKey === false) {\n      sendMessage(e);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(Root, {\n    children: [/*#__PURE__*/_jsxDEV(Conversation, {\n      children: [messages.map(function (message) {\n        var isAuthUserReceiver = authUser.id === message.sender.id;\n        return /*#__PURE__*/_jsxDEV(MessageWrapper, {\n          userMessage: isAuthUserReceiver,\n          children: [!isAuthUserReceiver && /*#__PURE__*/_jsxDEV(Spacing, {\n            right: \"xs\",\n            children: /*#__PURE__*/_jsxDEV(Avatar, {\n              image: message.sender.image\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 165,\n              columnNumber: 19\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 164,\n            columnNumber: 17\n          }, _this), /*#__PURE__*/_jsxDEV(Message, {\n            userMessage: isAuthUserReceiver,\n            children: message.message\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 169,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(MessageDate, {\n            userMessage: isAuthUserReceiver,\n            children: currentDate(message.createdAt)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 171,\n            columnNumber: 15\n          }, _this)]\n        }, message.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 13\n        }, _this);\n      }), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: bottomRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 7\n    }, _this), match.params.userId !== Routes.NEW_ID_VALUE && chatUser && /*#__PURE__*/_jsxDEV(Form, {\n      onSubmit: sendMessage,\n      children: [/*#__PURE__*/_jsxDEV(StyledTextarea, {\n        placeholder: \"Type a message\",\n        value: messageText,\n        onChange: function onChange(e) {\n          return setMessageText(e.target.value);\n        },\n        onKeyDown: onEnterPress\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 11\n      }, _this), /*#__PURE__*/_jsxDEV(SendButton, {\n        type: \"submit\",\n        ghost: true,\n        children: /*#__PURE__*/_jsxDEV(SendIcon, {\n          width: \"28\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 13\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 11\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 9\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 156,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(MessagesChatConversation, \"FqXBy3+QDzCBcdIUHDtFJXwy1pE=\", false, function () {\n  return [useMutation];\n});\n\n_c9 = MessagesChatConversation;\nMessagesChatConversation.propTypes = {\n  messages: PropTypes.array.isRequired,\n  authUser: PropTypes.object.isRequired,\n  chatUser: PropTypes.object,\n  data: PropTypes.any,\n  match: PropTypes.object.isRequired\n};\nexport default MessagesChatConversation;\n\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9;\n\n$RefreshReg$(_c, \"Root\");\n$RefreshReg$(_c2, \"Conversation\");\n$RefreshReg$(_c3, \"MessageDate\");\n$RefreshReg$(_c4, \"MessageWrapper\");\n$RefreshReg$(_c5, \"Message\");\n$RefreshReg$(_c6, \"Form\");\n$RefreshReg$(_c7, \"StyledTextarea\");\n$RefreshReg$(_c8, \"SendButton\");\n$RefreshReg$(_c9, \"MessagesChatConversation\");","map":{"version":3,"sources":["/Users/hieutran/Desktop/create-social-network-master/frontend/src/pages/Messages/MessagesChatConversation.js"],"names":["React","useState","useRef","useEffect","styled","PropTypes","useMutation","Button","Textarea","SendIcon","Avatar","Spacing","CREATE_MESSAGE","GET_CONVERSATIONS","currentDate","Routes","Root","div","p","theme","spacing","sm","colors","grey","radius","lg","Conversation","MessageDate","span","userMessage","font","size","tiny","text","secondary","MessageWrapper","md","Message","xs","xxs","white","primary","light","Form","form","StyledTextarea","SendButton","MessagesChatConversation","messages","authUser","chatUser","data","match","bottomRef","messageText","setMessageText","createMessage","current","scrollIntoView","sendMessage","e","preventDefault","variables","input","sender","id","receiver","message","refetchQueries","isFirstMessage","query","authUserId","onEnterPress","keyCode","shiftKey","map","isAuthUserReceiver","image","createdAt","params","userId","NEW_ID_VALUE","target","value","propTypes","array","isRequired","object","any"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport styled from 'styled-components';\nimport PropTypes from 'prop-types';\nimport { useMutation } from '@apollo/client';\n\nimport { Button, Textarea } from 'components/Form';\nimport { SendIcon } from 'components/icons';\nimport Avatar from 'components/Avatar';\nimport { Spacing } from 'components/Layout';\n\nimport { CREATE_MESSAGE } from 'graphql/messages';\nimport { GET_CONVERSATIONS } from 'graphql/user';\n\nimport { currentDate } from 'utils/date';\n\nimport * as Routes from 'routes';\n\nconst Root = styled.div`\n  padding: 0 ${(p) => p.theme.spacing.sm};\n  overflow-y: auto;\n  height: 100vh;\n  margin-top: -120px;\n  padding-top: 120px;\n  display: flex;\n  flex-direction: column;\n\n  ::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background-color: ${(p) => p.theme.colors.grey[500]};\n    border-radius: ${(p) => p.theme.radius.lg};\n    visibility: hidden;\n\n    &:hover {\n      background-color: ${(p) => p.theme.colors.grey[600]};\n    }\n  }\n\n  &:hover {\n    ::-webkit-scrollbar-thumb {\n      visibility: visible;\n    }\n  }\n`;\n\nconst Conversation = styled.div`\n  flex: 1;\n`;\n\nconst MessageDate = styled.span`\n  position: absolute;\n  bottom: -${(p) => p.theme.spacing.sm};\n  left: ${(p) => !p.userMessage && p.theme.spacing.lg};\n  right: -${(p) => p.userMessage && 0};\n  display: none;\n  font-size: ${(p) => p.theme.font.size.tiny};\n  color: ${(p) => p.theme.colors.text.secondary};\n`;\n\nconst MessageWrapper = styled.div`\n  display: flex;\n  position: relative;\n  justify-content: ${(p) => p.userMessage && 'flex-end'};\n  margin: ${(p) => p.theme.spacing.md} 0;\n\n  &:hover ${MessageDate} {\n    display: block;\n  }\n`;\n\nconst Message = styled.div`\n  display: flex;\n  flex-direction: row;\n  position: relative;\n  max-width: 300px;\n  line-height: 21px;\n  font-size: ${(p) => p.theme.font.size.xs};\n  padding: ${(p) => p.theme.spacing.xxs} ${(p) => p.theme.spacing.xs};\n  border-radius: ${(p) => p.theme.radius.lg};\n  color: ${(p) => p.userMessage && p.theme.colors.white};\n  background-color: ${(p) => (p.userMessage ? p.theme.colors.primary.light : p.theme.colors.grey[200])};\n`;\n\nconst Form = styled.form`\n  background-color: ${(p) => p.theme.colors.white};\n  position: sticky;\n  bottom: 0;\n  width: 100%;\n  display: flex;\n  padding: ${(p) => p.theme.spacing.xxs};\n`;\n\nconst StyledTextarea = styled(Textarea)`\n  height: 38px;\n  border-radius: ${(p) => p.theme.radius.lg};\n  background-color: ${(p) => p.theme.colors.grey[200]};\n`;\n\nconst SendButton = styled(Button)`\n  margin-left: ${(p) => p.theme.spacing.sm};\n  align-self: center;\n`;\n\n/**\n * Component that renders messages conversations UI\n */\nconst MessagesChatConversation = ({ messages, authUser, chatUser, data, match }) => {\n  const bottomRef = useRef(null);\n\n  const [messageText, setMessageText] = useState('');\n\n  const [createMessage] = useMutation(CREATE_MESSAGE);\n\n  useEffect(() => {\n    if (bottomRef.current) {\n      bottomRef.current.scrollIntoView();\n    }\n  }, [bottomRef, data]);\n\n  const sendMessage = (e) => {\n    e.preventDefault();\n\n    if (!messageText) return;\n\n    setMessageText('');\n    createMessage({\n      variables: {\n        input: {\n          sender: authUser.id,\n          receiver: chatUser ? chatUser.id : null,\n          message: messageText,\n        },\n      },\n      refetchQueries: ({ data }) => {\n        if (data && data.createMessage && data.createMessage.isFirstMessage) {\n          return [\n            {\n              query: GET_CONVERSATIONS,\n              variables: { authUserId: authUser.id },\n            },\n          ];\n        }\n      },\n    });\n  };\n\n  const onEnterPress = (e) => {\n    if (e.keyCode === 13 && e.shiftKey === false) {\n      sendMessage(e);\n    }\n  };\n\n  return (\n    <Root>\n      <Conversation>\n        {messages.map((message) => {\n          const isAuthUserReceiver = authUser.id === message.sender.id;\n\n          return (\n            <MessageWrapper userMessage={isAuthUserReceiver} key={message.id}>\n              {!isAuthUserReceiver && (\n                <Spacing right=\"xs\">\n                  <Avatar image={message.sender.image} />\n                </Spacing>\n              )}\n\n              <Message userMessage={isAuthUserReceiver}>{message.message}</Message>\n\n              <MessageDate userMessage={isAuthUserReceiver}>{currentDate(message.createdAt)}</MessageDate>\n            </MessageWrapper>\n          );\n        })}\n        <div ref={bottomRef} />\n      </Conversation>\n\n      {match.params.userId !== Routes.NEW_ID_VALUE && chatUser && (\n        <Form onSubmit={sendMessage}>\n          <StyledTextarea\n            placeholder=\"Type a message\"\n            value={messageText}\n            onChange={(e) => setMessageText(e.target.value)}\n            onKeyDown={onEnterPress}\n          />\n\n          <SendButton type=\"submit\" ghost>\n            <SendIcon width=\"28\" />\n          </SendButton>\n        </Form>\n      )}\n    </Root>\n  );\n};\n\nMessagesChatConversation.propTypes = {\n  messages: PropTypes.array.isRequired,\n  authUser: PropTypes.object.isRequired,\n  chatUser: PropTypes.object,\n  data: PropTypes.any,\n  match: PropTypes.object.isRequired,\n};\n\nexport default MessagesChatConversation;\n"]},"metadata":{},"sourceType":"module"}